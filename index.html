<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projekt 4 Voting</title>
    <style>
        body {
            font-family: arial;
            width: 800px;
            margin: 0 auto; 
        }

        input, 
        select, 
        button {
            display: block;
            margin: 20px 0; 
        }
    </style>
</head>
<body>
    <h1>Stystem do głosowania</h1>
    <h2>Zagłosuj</h2>
    <form class="voting-form">
        <label>Nazwa użytkownika: <input type="text" class="user-name" required></label>
        <label>Identyfikator (8cyfr): <input type="text" class="user-id" required maxlength="8" minlength="8"></label>
        <select class="vote-options">
            <option value="Opcja 1">Zdecydowanie TAK!</option>
            <option value="Opcja 2">Zdecydowanie NIE!</option>
            <option value="Opcja 3">Precz z komuną!</option>
        </select>
        <button type="submit" class="btn-submit-form">Zagłosuj</button>
    </form>
    <h2>Wyniki głosowania</h2>
    <div class="vote-results"></div>
    <script>
        const votingForm = document.querySelector('.voting-form'); 
        const voteOptions = document.querySelector('.vote-options');
        const userName = document.querySelector('.user-name'); 
        const userID = document.querySelector('.user-id'); 
        const resultDiv = document.querySelector('.vote-results');

        const validUserIds = new Map([
            ['Romuś', '12345678'],
            ['Stasio', '11111111'],
            ['Barti', '12341234'],
            ['Dżastina', '00000001'],
        ]); 

        const voteCounts = new Map();
        voteCounts.set('Opcja 1', 0); 
        voteCounts.set('Opcja 2', 0); 
        voteCounts.set('Opcja 3', 0);

        //userzy, którzy już zagłosowali
        const votedUsers = new Set();

        const voting = (e) => {
            e.preventDefault();
            const user = userName.value; 
            const password = userID.value; 
            const select = voteOptions.value; 

            if(validUserIds.get(user) === password) {
                //czy głosował?
                if(votedUsers.has(user)) {
                    alert('już głosowałeś');
                } else {
                    //logika ważnego głosu
                    votedUsers.add(user);
                    voteCounts.set(select, voteCounts.get(select) +1);
                }
                } else {
                    alert('nieprawidłowe dane'); 
                }

            updateResults();
        }

        const updateResults = () => {
            let output = '<h1>WYNIK</h1>';
            for (const [option, count] of voteCounts) {
                output += `${option} : ${count} głosów.<br>`
            }
            //voteCounts.forEach((count, option) => {
             //   output += `${option} : ${count} głosów.<br>`;
            //});
        
            resultDiv.innerHTML = output; 
        }; 
        votingForm.addEventListener('submit', voting); 
    </script>
</body>
</html>